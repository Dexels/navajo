<?xml version="1.0" encoding="UTF-8"?>
<tsl author="Matthijs Philip" id="person/ProcessQueryPerson" notes="" repository="$Id$" xmlns="http://www.dexels.com/navascript" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://www.dexels.com/navascript http://www.dexels.com/schema/navascript.xsd ">   
    <methods>
        <method name="person/ProcessUpdatePerson">
            <required message="Person"/>            
        </method>
        <method name="person/ProcessDeletePerson">
            <required message="Person"/>            
        </method>
    </methods>
    <!-- Determine selected PersonId -->
    <map object="com.dexels.navajo.adapter.MultipleEmptyMap">
        <field name="emptyMaps">
            <map ref="/Person" filter="?[Update] AND [Update]">
                <param name="PersonId">
                    <expression value="[PersonId]"/>
                </param>
            </map>
        </field>
    </map>
    <param name="PersonId" condition="!?[/@PersonId] AND ?[/Person/PersonId]">
        <expression value="[/Person/PersonId]"/>
    </param>
    <map object="com.dexels.navajo.adapter.SQLMap">
        <field name="datasource">
            <expression value="'default'"/>
        </field>
        <field name="query">
            <expression xml:space="preserve">
               SELECT lastname
               ,      infix
               ,      initials
               ,      firstname
               ,      dateofbirth
               ,      nationality
               ,      sex
               ,      streetname 
               ,      housenumber
               ,      numberappendix
               ,      city
               ,      zipcode
               ,      countrycode
               ,      telephonenumber
               ,      mobilenumber
               ,      emailaddress
               FROM   person
               WHERE  id = ?
            </expression>
        </field>
        <field name="parameter">
            <expression value="[/@PersonId]"/>
        </field>
        <message name="Person" condition="$rowCount &gt; 0">
            <property name="PersonId" type="integer" direction="out" description="CV code (intern)">
                <expression value="[/@PersonId]"/>
            </property>
            <property name="LastName" type="string" direction="in" description="Achternaam">
                <expression value="$columnValue('lastname')"/>
            </property>
            <property name="Infix" type="string" direction="in" description="Tussenvoegsel">
                <expression value="$columnValue('infix')"/>
            </property>
            <property name="Initials" type="string" direction="in" description="Initialen">
                <expression value="$columnValue('initials')"/>
            </property>
            <property name="FirstName" type="string" direction="in" description="Voornaam">
                <expression value="$columnValue('firstname')"/>
            </property>
            <property name="DateOfBirth" type="date" direction="in" description="Geboortedatum">
                <expression value="$columnValue('dateofbirth')"/>
            </property>
            <property name="Age" type="integer" direction="out" description="Leeftijd">
                <expression value="Age($columnValue('dateofbirth'))"/>
            </property>
            <property name="Nationality" type="string" direction="in" description="Nationaliteit">
                <expression value="$columnValue('nationality')"/>
            </property>
            <property name="Sex" type="selection" direction="in" description="Geslacht">
                <option name="Onbekend" value="0" condition="$columnValue('sex') == '0'" selected="1"/>
                <option name="Onbekend" value="0" condition="$columnValue('sex') != '0'" selected="0"/>
                <option name="Man" value="1" condition="$columnValue('sex') == '1'" selected="1"/>
                <option name="Man" value="1" condition="$columnValue('sex') != '1'" selected="0"/>
                <option name="Vrouw" value="2" condition="$columnValue('sex') == '2'" selected="1"/>                
                <option name="Vrouw" value="2" condition="$columnValue('sex') != '2'" selected="0"/>                
            </property>
            <property name="StreetName" type="string" direction="in" description="Straat">
                 <expression value="$columnValue('streetname')"/>
            </property>
            <property name="HouseNumber" type="integer" direction="in" description="Huisnummer">
                 <expression value="$columnValue('housenumber')"/>
            </property>
            <property name="NumberAppendix" type="string" direction="in" description="Toevoeging">
                 <expression value="$columnValue('numberappendix')"/>
            </property>
            <property name="City" type="string" direction="in" description="Woonplaats">
                 <expression value="$columnValue('city')"/>
            </property>
            <property name="ZipCode" type="string" direction="in" description="Postcode">
                 <expression value="$columnValue('zipcode')"/>
            </property>
            <property name="CountryCode" type="string" direction="in" description="Landcode">
                 <expression value="$columnValue('countrycode')"/>
            </property>
            <property name="TelephoneNumber" type="string" direction="in" description="Telefoonnummer">
                <expression value="$columnValue('telephonenumber')"/>
            </property>
            <property name="MobileNumber" type="string" direction="in" description="Mobiel nummer">
                <expression value="$columnValue('mobilenumber')"/>
            </property>
            <property name="EmailAddress" type="string" direction="in" description="E-mailadres">
                <expression value="$columnValue('emailaddress')"/>
            </property>
        </message>
    </map>
</tsl>
