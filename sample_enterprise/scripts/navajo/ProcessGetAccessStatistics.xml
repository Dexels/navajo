<?xml version="1.0" encoding="UTF-8"?>
<tsl xmlns="http://www.dexels.com/navascript" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://www.dexels.com/navascript http://mail.dexels.com:8080/schema/navascript.xsd">
    <message name="Series">
        <property name="Series" type="selection" direction="in" cardinality="+">
            <option name="Max thread count" value="MaxThreadCount"/>
            <option name="Average thread count" value="AverageThreadCount"/>
            <option name="Rate (#webservices/minute)" value="Rate"/>
            <option name="Total WS overall-time (ms)" value="TotalTime"/>
            <option name="Total WS parse-time (ms)" value="TotalParseTime"/>
            <option name="Total WS authorisation-time (ms)" value="TotalAuthorisationTime"/>
            <option name="Total WS processing-time (ms)" value="TotalProcessingTime"/>
            <option name="Total size of XML requests (bytes)" value="TotalRequestSize"/>
            <option name="Average WS processing time (ms/#webservices/minute)" value="AverageProcessingTime"/>
            <option name="Average XML request size (bytes/#webservices/minute)" value="AverageRequestSize"/>
        </property>
    </message>
    <map object="com.dexels.navajo.adapter.SQLMap">
        <field name="datasource">
            <expression value="'navajostore'"/>
        </field>
        <field name="debug">
            <expression value="true"/>
        </field>
        <field name="query">
            <expression xml:space="preserve" condition="[/StatisticsParameters/View:value] == 'H'">
                               SELECT 
                to_char( CAST (created AS date), 'DD')||'-'||to_char( CAST (created AS date), 'MM')||'-'||to_char( CAST (created AS date), 'YYYY')||' '||to_char(created, 'HH24')||':'||
                to_char(created, 'MI') AS timestamp,
                count(*) AS rate, max(threadcount) AS maxthreadcount, avg(threadcount) AS threadcount, sum(totaltime) AS totaltime, 
                sum(parsetime) AS totalparsetime, sum(authorisationtime) AS totalauthorisationtime, 
                sum(requestsize) AS totalrequestsize
                FROM navajoaccess
                WHERE
                to_char(sysdate, 'YYYY') = to_char( CAST (created AS date), 'YYYY') AND
                to_char(sysdate, 'MM') = to_char( CAST (created AS date), 'MM') AND
                to_char(sysdate, 'DD') = to_char( CAST (created AS date), 'DD') AND
                to_number(to_char(systimestamp, 'HH24')) - 8 &lt; to_number(to_char(created, 'HH24'))
                GROUP BY to_char( CAST (created AS date), 'MM'), to_char( CAST (created AS date), 'DD'), to_char( CAST (created AS date), 'YYYY'), to_char(created, 'HH24'), to_char(created, 'MI')
               ORDER BY timestamp
           </expression>
            <expression xml:space="preserve" condition="[/StatisticsParameters/View:value] == 'D'">
                    SELECT 
                to_char( CAST (created AS date), 'DD')||'-'||to_char( CAST (created AS date), 'MM')||'-'||to_char( CAST (created AS date), 'YYYY')||' '||to_char(created, 'HH24') AS timestamp,
                count(*) AS rate, max(threadcount) AS maxthreadcount, avg(threadcount) AS threadcount, sum(totaltime) AS totaltime, 
                sum(parsetime) AS totalparsetime, sum(authorisationtime) AS totalauthorisationtime, 
                sum(requestsize) AS totalrequestsize
                FROM navajoaccess
                WHERE
                to_char(sysdate, 'YYYY') = to_char( CAST (created AS date), 'YYYY') AND
                to_char(sysdate, 'MM') = to_char( CAST (created AS date), 'MM') AND
                to_number(to_char(systimestamp, 'DD')) - 5 &lt; to_number(to_char(created, 'DD'))
                GROUP BY to_char( CAST (created AS date), 'MM'), to_char( CAST (created AS date), 'DD'), to_char( CAST (created AS date), 'YYYY'), to_char(created, 'HH24')
               ORDER BY timestamp
           </expression>
            <expression xml:space="preserve" condition="[/StatisticsParameters/View:value] == 'W'">
                              SELECT 
                to_char( CAST (created AS date), 'DD')||'-'||to_char( CAST (created AS date), 'MM')||'-'||to_char( CAST (created AS date), 'YYYY') AS timestamp,
                count(*) AS rate, max(threadcount) AS maxthreadcount, avg(threadcount) AS threadcount, sum(totaltime) AS totaltime, 
                sum(parsetime) AS totalparsetime, sum(authorisationtime) AS totalauthorisationtime, 
                sum(requestsize) AS totalrequestsize
                FROM navajoaccess
                WHERE
                to_char(sysdate, 'YYYY') = to_char( CAST (created AS date), 'YYYY') AND
                to_char(sysdate, 'MM') = to_char( CAST (created AS date), 'MM') AND
                to_number(to_char(systimestamp, 'IW')) - 5 &lt; to_number(to_char(created, 'IW'))
                GROUP BY to_char( CAST (created AS date), 'MM'), to_char( CAST (created AS date), 'DD'), to_char( CAST (created AS date), 'YYYY')
               ORDER BY timestamp
           </expression>
            <expression xml:space="preserve" condition="[/StatisticsParameters/View:value] == 'M'">
                             SELECT 
                to_char( CAST (created AS date), 'DD')||'-'||to_char( CAST (created AS date), 'MM')||'-'||to_char( CAST (created AS date), 'YYYY') AS timestamp,
                count(*) AS rate, max(threadcount) AS maxthreadcount, avg(threadcount) AS threadcount, sum(totaltime) AS totaltime, 
                sum(parsetime) AS totalparsetime, sum(authorisationtime) AS totalauthorisationtime, 
                sum(requestsize) AS totalrequestsize
                FROM navajoaccess
                WHERE
                to_char(sysdate, 'YYYY') = to_char( CAST (created AS date), 'YYYY') AND
                to_number(to_char(systimestamp, 'MM')) - 10 &lt; to_number(to_char(created, 'MM'))
                GROUP BY to_char( CAST (created AS date), 'MM'), to_char( CAST (created AS date), 'DD'), to_char( CAST (created AS date), 'YYYY')
               ORDER BY timestamp
           </expression>
            <expression xml:space="preserve">
                            SELECT 
                to_char( CAST (created AS date), 'DD')||'-'||to_char( CAST (created AS date), 'MM')||'-'||to_char( CAST (created AS date), 'YYYY') AS timestamp,
                count(*) AS rate, max(threadcount) AS maxthreadcount, avg(threadcount) AS threadcount, sum(totaltime) AS totaltime, 
                sum(parsetime) AS totalparsetime, sum(authorisationtime) AS totalauthorisationtime, 
                sum(requestsize) AS totalrequestsize
                FROM navajoaccess
                WHERE
                to_char(sysdate, 'YYYY') = to_char( CAST (created AS date), 'YYYY') 
                GROUP BY to_char( CAST (created AS date), 'MM'), to_char( CAST (created AS date), 'DD'), to_char( CAST (created AS date), 'YYYY')
               ORDER BY timestamp
           </expression>
        </field>
        <message name="Statistics">
            <map ref="resultSet">
                <property name="TimestampAsString" direction="out">
                    <expression value="$columnValue('timestamp')"/>
                </property>
                <property name="Timestamp" direction="out">
                    <expression value="ParseDate($columnValue('timestamp'), 'dd-MM-yyyy HH:mm')" condition="[/StatisticsParameters/View:value] == 'H'"/>
                    <expression value="ParseDate($columnValue('timestamp'), 'dd-MM-yyyy HH')" condition="[/StatisticsParameters/View:value] == 'D'"/>
                    <expression value="ParseDate($columnValue('timestamp'), 'dd-MM-yyyy')" condition="[/StatisticsParameters/View:value] == 'W'"/>
                    <expression value="ParseDate($columnValue('timestamp'), 'dd-MM-yyyy')" condition="[/StatisticsParameters/View:value] == 'M'"/>
                    <expression value="ParseDate($columnValue('timestamp'), 'dd-MM-yyyy')"/>
                </property>
                <property name="Rate" direction="out" description="Rate (#webservices/minute)">
                    <expression value="$columnValue('rate')"/>
                </property>
                <property name="MaxThreadCount" direction="out" description="Maximum number of active threads">
                    <expression value="$columnValue('maxthreadcount')"/>
                </property>
                <property name="AverageThreadCount" direction="out" description="Average number of active threads">
                    <expression value="$columnValue('threadcount')"/>
                </property>
                <property name="TotalTime" direction="out" description="Total WS overall-time (ms)">
                    <expression value="$columnValue('totaltime')"/>
                </property>
                <property name="TotalParseTime" direction="out" description="Total WS parse-time (ms)">
                    <expression value="$columnValue('totalparsetime')"/>
                </property>
                <property name="TotalAuthorisationTime" direction="out" description="Total WS authorisation-time (ms)">
                    <expression value="$columnValue('totalauthorisationtime')"/>
                </property>
                <param name="TotalProcessingTime">
                    <expression value="$columnValue('totaltime') - $columnValue('totalauthorisationtime') - $columnValue('totalparsetime')"/>
                </param>
                <property name="TotalProcessingTime" direction="out" description="Total WS processing-time (ms)">
                    <expression value="[/__parms__/TotalProcessingTime]"/>
                </property>
                <property name="TotalRequestSize" direction="out" description="Total size of XML requests (bytes)">
                    <expression value="$columnValue('totalrequestsize')"/>
                </property>
                <property name="AverageProcessingTime" direction="out" description="Average WS processing time (ms/#webservices/minute)">
                    <expression value="ToDouble([/__parms__/TotalProcessingTime]) / ToDouble($columnValue('rate'))"/>
                </property>
                <property name="AverageRequestSize" direction="out" description="Average XML request size (bytes/#webservices/minute)">
                    <expression value="ToDouble($columnValue('totalrequestsize')) / ToDouble($columnValue('rate'))"/>
                </property>
            </map>
        </message>
    </map>
</tsl>
