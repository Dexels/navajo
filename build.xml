<?xml version="1.0" encoding="UTF-8" ?>
<!-- $Id$ -->

<project name="NavajoServer" default="all" basedir=".">

	<taskdef name="deploy" classname="org.apache.catalina.ant.DeployTask" />
	<taskdef name="undeploy" classname="org.apache.catalina.ant.UndeployTask" />

	<property name="tar.archive" value="NavajoServer.tgz" />

	<property name="zip.archive" value="NavajoServer.zip" />
	<property name="war.archive" value="NavajoServer.war" />
	<property name="publish" value="publish" />
	<property name="sourcetar.archive" value="NavajoServerSource.tgz" />
	<property name="sourcezip.archive" value="NavajoServerSource.zip" />
	<property name="deployRoot" value="${deployUser}@${deployServer}:${deployPath}/Navajo" />
	<echo message="${deployRoot}">
	</echo>
	<delete dir="source/"/>

	<copy todir="source">
		<fileset file="sourcebuild.xml">
		</fileset>
	</copy>
	<copy todir="source/Navajo">
		<fileset dir="${PROJECTHOME}/Navajo/src">
			<include name="**/*" />

			<!-- enterprise -->
			<exclude name="com/dexels/navajo/scheduler/**" />
			<exclude name="com/dexels/navajo/tribe/**" />
			<exclude name="com/dexels/navajo/workflow/**" />
			<exclude name="com/dexels/navajo/adapter/**" />
			<exclude name="com/dexels/navajo/integrity/**" />
			<exclude name="com/dexels/navajo/jabber/**" />
			<exclude name="com/dexels/navajo/server/descriptionprovider/**" />
			<exclude name="com/dexels/navajo/server/statistics/**" />
			<exclude name="com/dexels/navajo/server/monitoring/**" />

			<!-- server -->

			<!--
			<exclude name="com/dexels/navajo/server/Dispatcher.*" />
			<exclude name="com/dexels/navajo/server/NavajoConfig.*" />
			<exclude name="com/dexels/navajo/server/Access.*" />
		    <exclude name="com/dexels/navajo/lockguard/**" />
		    <exclude name="com/dexels/navajo/server/jmx/**" />
			<exclude name="com/dexels/navajo/client/**" />
			<exclude name="com/dexels/navajo/install/**" />
			<exclude name="com/dexels/navajo/compiler/**" />
			<exclude name="com/dexels/navajo/mapping/compiler/**" />
			<exclude name="org/**" />-->

			<!-- source file, never needed. -->
			<!--	<exclude name="**/*.jj" />-->
			<exclude name="**/*.jjt" />
			<exclude name="**/*.bat" />

		</fileset>

	</copy>

	<copy todir="source/NavajoDocument">
		<fileset dir="${PROJECTHOME}/NavajoDocument/src" />
	</copy>
	<copy todir="source/NavajoClient">
		<fileset dir="${PROJECTHOME}/NavajoClient/src" />
	</copy>
	<copy todir="source/NavajoListeners">
		<fileset dir="${PROJECTHOME}/NavajoListeners/src">
			<exclude name="com/dexels/navajo/server/listener/http/LaszloUploadServlet.java" />
			<exclude name="com/dexels/navajo/server/listener/soap/**" />
			<exclude name="com/dexels/navajo/server/listener/smtp/**" />
			<exclude name="com/dexels/navajo/server/listener/wsdl/**" />
		</fileset>
	</copy>
	<copy todir="source/NavajoFunctions">
		<fileset dir="${PROJECTHOME}/NavajoFunctions/src">
			<exclude name="com/dexels/navajo/functions/ExistsWorkflow.java" />
		</fileset>
	</copy>
	<copy todir="source/NavajoAdapters">
		<fileset dir="${PROJECTHOME}/NavajoAdapters/src">
			<exclude name="com/dexels/navajo/adapter/descriptionprovider/**" />
			<exclude name="com/dexels/navajo/adapter/crystal/**" />
			<exclude name="com/dexels/navajo/adapter/ibatis/**" />
			<exclude name="com/dexels/navajo/adapter/icalmap/**" />
			<exclude name="com/dexels/navajo/adapter/ldap/**" />
			<exclude name="com/dexels/navajo/adapter/poi/**" />
			<exclude name="com/dexels/navajo/adapter/rss/**" />
			<exclude name="com/dexels/navajo/adapter/navajostore/**" />
			<exclude name="com/dexels/navajo/adapter/SheetMap.java" />
			<exclude name="com/dexels/navajo/adapter/JabberBroadcastMap.java" />
			<exclude name="com/dexels/navajo/adapter/BabelFishMap.java" />
			<exclude name="com/dexels/navajo/adapter/FTPMap.java" />
			<exclude name="com/dexels/navajo/adapter/ICalMap.java" />
			<exclude name="com/dexels/navajo/adapter/OracleAdministratorMap.java" />
			<exclude name="com/dexels/navajo/adapter/RSSMap.java" />
			<exclude name="com/dexels/navajo/adapter/NavajoMap.java" />
			<exclude name="com/dexels/navajo/adapter/VersionedNavajoMap.java" />
			<exclude name="com/dexels/navajo/adapter/SOAPMap.java" />
			<exclude name="com/dexels/navajo/adapter/SPMap.java" />
			<exclude name="com/dexels/navajo/adapter/MultipleSQLMap.java" />
			<exclude name="com/dexels/navajo/adapter/html/**" />
		</fileset>

	</copy>
	<copy todir="source/DexelsVersionControl">
		<fileset dir="${PROJECTHOME}/DexelsVersionControl/src" />
	</copy>
	<target name="clean">
		<delete dir="WEB-INF/lib">
			<include name="*.jar" />
		</delete>
		<delete dir="dist">
		</delete>
	</target>


	<target name="tar" depends="compile">
		<tar tarfile="${tar.archive}" longfile="gnu" basedir="dist">
		</tar>
	</target>
	<target name="war" depends="compile">
		<war destfile="${publish}/${war.archive}" basedir="dist" webxml="dist/WEB-INF/web.xml">
		</war>
	</target>
	<target name="zip" depends="compile">
		<zip zipfile="${publish}/${zip.archive}" basedir="dist">
		</zip>
	</target>


	<target name="sourcetar">
		<tar tarfile="${publish}/${sourcetar.archive}" basedir="source">
		</tar>
	</target>
	<target name="sourcezip">
		<zip zipfile="${publish}/${sourcezip.archive}" basedir="source">
		</zip>
	</target>




	<target name="grab" depends="clean">
		<ant antfile="build.xml" dir="../NavajoClient" />
		<ant antfile="build.xml" dir="../Navajo" />
		<ant antfile="build.xml" dir="../NavajoLogger" />
		<ant antfile="build.xml" dir="../NavajoFunctions" />
		<ant antfile="build.xml" dir="../NavajoAdapters" />
		<mkdir dir="${publish}" />

		<copy todir="dist/WEB-INF/lib">

			<fileset file="../NavajoClient/NavajoClient.jar" />
			<fileset file="../NavajoAdapters/NavajoAdapters.jar" />
			<fileset file="../NavajoDocument/*.jar" />
			<fileset file="../NavajoBirt/*.jar" />
			<fileset file="../Navajo/NavajoRuntime.jar" />
			<fileset file="../Navajo/NavajoServer.jar" />
			<fileset file="../NavajoFunctions/NavajoFunctions.jar" />
			<fileset file="../NavajoLogger/NavajoLogger.jar" />
			<fileset file="../NavajoListeners/NavajoListeners.jar" />
			<fileset file="3rdparty/**">
				<exclude name="servlet**" />
			</fileset>
			<fileset file="sample/3rdparty/**"/>
						
		</copy>
		<copy todir="dist/WEB-INF">
			<fileset file="sample/WEB-INF/web.xml" />
		</copy>
		<copy todir="dist/config">
			<fileset file="sample/config/**" />
		</copy>
		<copy todir="dist/adapters">
			<fileset file="sample/adapters/*.jar" />
		</copy>
		<copy todir="dist/scripts">
			<fileset file="sample/scripts/**" />
		</copy>
		<copy todir="dist/resource">
			<fileset file="sample/resource/**" />
		</copy>
		<copy todir="dist/resource">
			<fileset file="resource/**" />
		</copy>
		<copy todir="dist/">
			<fileset file="sample/index.html" />
			<fileset file="sample/logo-dexels.gif" />
		</copy>





	</target>
	<target name="compile" depends="grab">
		<ant antfile="sourcebuild.xml" dir="." />
	</target>

	<target name="sourcebuild" depends="sourcezip,sourcetar"/>
			
	<target name="archive" depends="war,tar,zip,sourcebuild" />


	<target name="publish" depends="archive">
		<echo message="${deployRoot}"/>
		<scp trust="true" sftp="true" verbose="true" todir="${deployRoot}">
			<fileset dir="${publish}">
				<include name="**" />
			</fileset>
		</scp>
	</target>
	<target name="deploy" depends="archive">
		<deploy  url="http://spiritus.dexels.nl:8080/manager" update="true" username="navajo" path="/${ant.project.name}" war="${publish}/NavajoServer.war" />
	</target>

	<target name="all" depends="publish,deploy"/>

</project>
<!-- EOF: $RCSfile$ -->
