<?xml version="1.0" encoding="UTF-8"?>
<workflow>
    <state id="init">
        <transition trigger="navajo:InitNavajoDemo" nextstate="start"/>
    </state>
    <state id="start">
        <transition trigger="navajo:InitAap" nextstate="waitforinput"/>
    </state>
    <state id="waitforinput">
        <!-- If nothing happens for 20 seconds, quit workflow -->
        <task service="person/InitInsertPerson"/>
        <transition trigger="offsettime:2m" nextstate="null"/>
        <transition trigger="navajo:ProcessAap" nextstate="approve">
            <param name="Name">
                <expression value="[/Result/Name]"/>
            </param>
        </transition>
    </state>
    <state id="approve">
        <transition trigger="beforenavajo:ProcessApproveAap" proxy="person/InitInsertPerson" nextstate="null" condition="[/Approval/Name] == [/@Name] AND [/Approval/Status] == 'nok'"/>
        <transition trigger="navajo:ProcessApproveAap" nextstate="null" condition="[/Approval/Name] == [/@Name] AND [/Approval/Status] == 'ok'"/>
        <transition trigger="navajo:ProcessApproveAap" nextstate="start" condition="[/Approval/Name] == [/@Name] AND [/Approval/Status] != 'ok'"/>
    </state>
</workflow>
