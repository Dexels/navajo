<?xml version="1.0" encoding="UTF-8"?>
<workflow id="NewMemberFlow">
    <state id="start">
        <transition trigger="navajo:ProcessInsertMember" nextstate="begin">
            <param name="PersonId">
                <expression value="[/Person/PersonId]"/>
            </param>
        </transition>
    </state>
    <state id="begin">
        <task service="ProcessNotifyEmployee"/>
        <transition trigger="navajo:ProcessValidateEmployee" condition="[/Status/Ok] == 'true' AND [/PersonId] == [/@PersonId]" nextstate="employeeOK"/>
        <transition trigger="navajo:ProcessValidateMember" condition="[Ok] == 'true'" nextstate="memberOK"/>
    </state>
    <state id="employeeOK">
        <transition trigger="navajo:ProcessValidateMember" condition="[Ok] == 'true'" nextstate="finished"/>
        <transition trigger="navajo:ProcessValidateMember" condition="[Ok] == 'false'" nextstate="begin"/>
    </state>
    <state id="memberOK">
        <transition trigger="navajo:ProcessValidateEmployee" condition="[Ok] == 'true'" nextstate="finished"/>
        <transition trigger="navajo:ProcessValidateEmployee" condition="[Ok] == 'false'" nextstate="begin"/>
    </state>
    <state id="finished">
        <task service="ProcessCongratulations"/>
    </state>
</workflow>
