<?xml version="1.0" encoding="UTF-8" ?>
<!-- $Id$ -->
<project name="TipiServer" default="publish" basedir=".">
	
	<taskdef name="deploy" classname="org.apache.catalina.ant.DeployTask" />
	<taskdef name="undeploy" classname="org.apache.catalina.ant.UndeployTask" />
	<taskdef name="start" classname="org.apache.catalina.ant.StartTask" />
	<taskdef name="stopApplication" classname="org.apache.catalina.ant.StopTask" />

<!--
    <property name="tipiTomcatServer" value="http://spiritus.dexels.nl:8080/"/>
    <property name="tipiTomcatManager" value="http://spiritus.dexels.nl:8080/manager"/>
-->
	
    <property name="tipiTomcatServer" value="http://localhost:8080/"/>
    <property name="tipiTomcatManager" value="http://localhost:8080/manager"/>
    <property name="tipiTomcatUsername" value="ad"/>
    <property name="tipiTomcatPassword" value="pw"/>

	<!--

-->
	
	<property name="src" location="src"/>
    <property name="lib" value="lib"/>
    <property name="archive" value="${ant.project.name}.jar"/>
    <target name="clean">
		<delete file="${ant.project.name}.war"/>
    	<delete file="${ant.project.name}.jar"/>
    </target>
	
	
	
	<target name="compile" depends="clean">
		<delete file="WebContent/WEB-INF/lib/TipiServer.jar"/>
    	<path id="tipiserverdepend">
    		<fileset dir="WebContent/WEB-INF/lib">
    			<include name="**/*.jar"/>
    		</fileset>
    		<fileset dir="compilelib">
    			<include name="**/*.jar"/>
    		</fileset>
    		<fileset dir="lib">
    			<include name="**/*.jar"/>
    		</fileset>
    	</path>

		<delete dir="classes"/>
		<mkdir dir="classes"/>
				
		<javac debug="true" srcdir="${src}" destdir="classes">
        	<classpath refid="tipiserverdepend" />
        </javac>
		<javac debug="true" srcdir="srcjnlp" destdir="classes">
        	<classpath refid="tipiserverdepend" />
        </javac>
    </target>

	<target name="resource" depends="compile">
		<copy todir="classes">
			<fileset dir="${src}">
				<exclude name="**/*.java" />
			</fileset>
			<fileset dir="srcjnlp">
				<exclude name="**/*.java" />
			</fileset>
		</copy>
	</target>
    <target name="archive" depends="resource">
<!--		<ant antfile="../TipiBuildLibrary/build.xml" target="archive"/>
-->
    	<jar jarfile="${archive}">
            <fileset dir="classes">
                 <exclude name="**/*.xml"/>
               </fileset>
		</jar>    	
    </target>

	
    <target name="jspdepend">
		
    </target>

    <target name="deploy" depends="jspdepend,archive">
    	<copy todir="../TipiServer/WebContent/WEB-INF/lib">
        			<fileset dir="../NavajoJsp">
        				<include  name="NavajoJsp.jar"/>
        			</fileset>
        		</copy> 
    	<copy todir="WebContent/WEB-INF/tags">
        			<fileset dir="../NavajoJsp/WEB-INF/tags">
        				<include  name="navajo.tld"/>
        			</fileset>
        		</copy> 
    	<copy todir="WebContent/WEB-INF/lib">
        			<fileset dir="../NavajoJsp/lib">
        				<include  name="*.jar"/>
        			</fileset>
        		</copy> 
    	
    	<echo message="JSP built!"/>
    	 <copy todir="../TipiServer/WebContent/WEB-INF/lib">
			<fileset dir=".">
				<include  name="${archive}"/>
			</fileset>
			<fileset dir="./lib">
				<include  name="*.jar"/>
			</fileset>
		</copy>
    	
    	<war basedir="${basedir}/WebContent" destfile="${ant.project.name}.war">
			<fileset dir="WebContent">
				<include  name="**"/>
				
			</fileset>
		</war>
    	<echo message="WAR Complete!"/>
    	
   <!--	<scp file="TipiServer.jar" todir="sportlink:sp0rtl1nk@hermes1.dexels.com:/usr/local/apache-tomcat-6.0.20/webapps/TipiAppStore/WEB-INF/lib"></scp>
    	  <scp file="WebContent/WEB-INF/lib/TipiServer.jar" todir="sportlink:sp0rtl1nk@hermes1.dexels.com:/usr/local/apache-tomcat-6.0.20/webapps/TipiAppStore/WEB-INF/lib"></scp>
  	  <scp todir="sportlink:sp0rtl1nk@hermes1.dexels.com:/usr/local/apache-tomcat-6.0.20/webapps/TipiAppStore/">
  	  	<fileset dir="WebContent">
  	  		<include name="*.jsp"/>
  	  	</fileset>
  	  </scp>-->	
	<!-- for now -->
<!--		<stopApplication />-->
    </target>
	<target name="publish" depends="deploy">
		<deploy  url="${tipiTomcatManager}" update="true" username="${tipiTomcatUsername}" password="${tipiTomcatPassword}" path="/${deploy.path}" war="${basedir}/${ant.project.name}.war"/>
 
	</target>
	    

</project>
<!-- EOF: $RCSfile$ -->
